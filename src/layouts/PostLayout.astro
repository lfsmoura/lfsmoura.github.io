---
import BaseLayout from './BaseLayout.astro';
import farcasterDiscussions from '../data/farcaster-discussions.json';

interface Props {
  frontmatter: {
    title: string;
    subtitle?: string;
    date?: Date;
    author?: string;
  };
}

const { frontmatter } = Astro.props;
const currentUrl = Astro.url.pathname;

// Find Farcaster discussion for this post (check with and without trailing slash)
const discussion = farcasterDiscussions.find(
  (d) => currentUrl.startsWith(d.url) || d.url.startsWith(currentUrl)
);

const dateFormat = new Intl.DateTimeFormat('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});
---

<BaseLayout title={frontmatter.title}>
  <article class="prose prose-blue max-w-none">
    <header class="post-header not-prose">
      <h1 class="post-title p-name !text-3xl !font-bold !mt-0" itemprop="name headline">
        {frontmatter.title}
      </h1>
      {frontmatter.subtitle && (
        <p class="text-lg text-gray-600 italic mt-2 mb-4">{frontmatter.subtitle}</p>
      )}
      {frontmatter.image && (
        <img
          src={frontmatter.image}
          alt={frontmatter.title}
          class="w-full h-auto rounded-lg my-4"
        />
      )}
      <p class="mb-4">
        {frontmatter.date && (
          <time class="text-gray-500" datetime={frontmatter.date.toISOString()} itemprop="datePublished">
            {dateFormat.format(frontmatter.date)}
          </time>
        )}
        {frontmatter.author && (
          <>
            {' '}&bull;{' '}
            <span itemprop="author" itemscope itemtype="http://schema.org/Person">
              <span class="p-author h-card" itemprop="name">{frontmatter.author}</span>
            </span>
          </>
        )}
      </p>
    </header>

    <div class="post-content e-content" itemprop="articleBody">
      <slot />
    </div>

    {discussion && (
      <div class="text-right">
        <p>
          <a href={`https://warpcast.com/lfsmoura/${discussion.hash}`}>
            See discussion on Farcaster &#8599;
          </a>
        </p>
      </div>
    )}

    <a class="u-url" href={currentUrl} hidden></a>
  </article>
</BaseLayout>
