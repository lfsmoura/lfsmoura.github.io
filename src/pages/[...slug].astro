---
import { getCollection } from 'astro:content';
import PostLayout from '../layouts/PostLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => {
    // Parse date from filename: 2024-03-17-emotional-awareness...
    const parts = post.slug.split('-');
    const year = parts[0];
    const month = parts[1];
    const day = parts[2];
    const slug = parts.slice(3).join('-');

    // Calculate date from filename
    const date = new Date(`${year}-${month}-${day}T00:00:00Z`);

    return {
      params: { slug: `${year}/${month}/${day}/${slug}` },
      props: { post, date },
    };
  });
}

const { post, date } = Astro.props;
const { Content } = await post.render();

// Use date from filename if not in frontmatter
const frontmatter = {
  ...post.data,
  date: post.data.date || date,
};
---

<PostLayout frontmatter={frontmatter}>
  <Content />
</PostLayout>
